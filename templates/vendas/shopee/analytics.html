{% extends "base.html" %}

{% block title %}Shopee Analytics Pro - Dashboard Avançado{% endblock %}

{% block extra_css %}
<link href="{{ url_for('static', filename='css/vendas/shopee/shopee_analytics.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="dashboard-container" data-theme="light">
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-content">
            <div class="header-title">
                <h1 class="brand-headline">
  <!-- SVG inline do logo Shopee -->
  <svg class="brand-logo" viewBox="0 0 64 64" aria-hidden="true" focusable="false">
    <!-- Sacola -->
    <path d="M52 24v26a6 6 0 0 1-6 6H18a6 6 0 0 1-6-6V24h40z" fill="currentColor"/>
    <path d="M52 24H12v-5a3 3 0 0 1 3-3h6.8a10.2 10.2 0 0 1 20.4 0H49a3 3 0 0 1 3 3v5z" fill="currentColor"/>
    <!-- Alça -->
    <path d="M41.2 16a9.2 9.2 0 0 0-18.4 0h-3.2a12.4 12.4 0 0 1 24.8 0h-3.2z" fill="#fff" opacity=".22"/>
    <!-- “S” estilizado -->
    <path d="M23.8 38.4c0-3.6 3.1-5.7 8.3-5.7 2.4 0 4.2.3 5.9.9v-2.5c-1.6-.6-3.6-1-6.1-1-7.4 0-11.8 3.3-11.8 8.3 0 10.7 17.2 6.2 17.2 11.2 0 1.9-2.1 3.1-6 3.1-3 0-6-.7-8.3-1.8v2.8c2.4 1 5.4 1.6 8.6 1.6 6.2 0 10-2.4 10-6.2 0-10.6-18-6.4-18-10.7z" fill="#fff"/>
  </svg>

  <span class="brand-title">
    <span class="brand-name">Shopee</span>
    <span class="brand-sep">•</span>
    <span class="brand-suite">Analytics</span>
  </span>
</h1>

                    <i class="fas fa-chart-line neon-icon"></i>
                    <span class="neon-text">Shopee Analytics Pro</span>
                </h1>
                <p class="header-subtitle">Análise de desempenho em tempo real com inteligência artificial</p>
            </div>
            <div class="header-actions">
                <div class="last-update">
                    <span>Última atualização:</span>
                    <span id="last-update-time">--:--:--</span>
                </div>
                <button class="btn-neon" id="refreshBtn">
                    <i class="fas fa-sync-alt"></i> Atualizar
                </button>
                <button class="btn-neon btn-export" id="exportBtn">
                    <i class="fas fa-file-export"></i> Exportar
                </button>
                <button class="btn-theme" id="themeToggle">
                    <i class="fas fa-moon" id="themeIcon"></i>
                </button>
            </div>
        </div>
        <a href="{{ url_for('shopee.curva_abc_page') }}" class="btn-neon">
  <i class="fas fa-chart-line me-2"></i> Curva ABC
</a>


        <!-- Filtros -->
        <div class="filters-container">
            <div class="filter-group">
                <label>Período</label>
                <div class="btn-group period-buttons">
                    <button class="btn-period active" data-period="7d">7 Dias</button>
                    <button class="btn-period" data-period="30d">30 Dias</button>
                    <button class="btn-period" data-period="90d">90 Dias</button>
                    <button class="btn-period" data-period="1y">1 Ano</button>
                </div>
            </div>

            <div class="filter-group">
                <label>Data Início</label>
                <input type="date" class="form-control" id="dataInicio">
            </div>

            <div class="filter-group">
                <label>Data Fim</label>
                <input type="date" class="form-control" id="dataFim">
            </div>

            <div class="filter-group">
                <label>Transportadora</label>
                <select class="form-control" id="transportadora">
                    <option value="">Todas</option>
                </select>
            </div>

            <div class="filter-group">
                <label>Tipo de Conta</label>
                <select class="form-control" id="tipoConta">
                    <option value="">Todos</option>
                </select>
            </div>
        </div>
    </header>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Carregando...</span>
        </div>
        <p class="mt-3">Carregando dados...</p>
    </div>

    <!-- Error Message -->
    <div class="error-message" id="errorMessage">
        <i class="fas fa-exclamation-triangle"></i>
        <span id="errorText">Erro ao carregar dados</span>
    </div>

    <!-- Métricas -->
    <div class="metrics-grid" id="metricsGrid">
        <div class="metric-card">
            <div class="metric-header">
                <span class="metric-title">Total de Vendas</span>
                <i class="fas fa-shopping-cart metric-icon"></i>
            </div>
            <div class="metric-value" id="totalVendas">0</div>
            <div class="metric-change positive">
                <i class="fas fa-arrow-up"></i>
                <span id="variacaoVendas">0%</span>
            </div>
        </div>

        <div class="metric-card">
            <div class="metric-header">
                <span class="metric-title">Receita Total</span>
                <i class="fas fa-dollar-sign metric-icon"></i>
            </div>
            <div class="metric-value" id="receitaTotal">R$ 0</div>
            <div class="metric-change positive">
                <i class="fas fa-arrow-up"></i>
                <span id="variacaoReceita">0%</span>
            </div>
        </div>

        <div class="metric-card">
            <div class="metric-header">
                <span class="metric-title">Lucro Total</span>
                <i class="fas fa-chart-line metric-icon"></i>
            </div>
            <div class="metric-value" id="lucroTotal">R$ 0</div>
            <div class="metric-change positive">
                <i class="fas fa-arrow-up"></i>
                <span id="variacaoLucro">0%</span>
            </div>
        </div>

        <div class="metric-card">
            <div class="metric-header">
                <span class="metric-title">Margem Média</span>
                <i class="fas fa-percentage metric-icon"></i>
            </div>
            <div class="metric-value" id="margemMedia">0%</div>
            <div class="metric-change positive">
                <i class="fas fa-arrow-up"></i>
                <span id="variacaoMargem">0%</span>
            </div>
        </div>

        <div class="metric-card">
            <div class="metric-header">
                <span class="metric-title">Ticket Médio</span>
                <i class="fas fa-receipt metric-icon"></i>
            </div>
            <div class="metric-value" id="ticketMedio">R$ 0</div>
            <div class="metric-change positive">
                <i class="fas fa-arrow-up"></i>
                <span id="variacaoTicket">0%</span>
            </div>
        </div>

        <div class="metric-card">
            <div class="metric-header">
                <span class="metric-title">Produtos Diferentes</span>
                <i class="fas fa-boxes metric-icon"></i>
            </div>
            <div class="metric-value" id="produtosDiferentes">0</div>
            <div class="metric-change positive">
                <i class="fas fa-arrow-up"></i>
                <span id="variacaoProdutos">0%</span>
            </div>
        </div>
    </div>

    <!-- Gráficos -->
    <div class="charts-grid">
        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title">Evolução de Vendas</h3>
                <div class="chart-actions">
                    <button class="btn btn-sm btn-outline-primary" onclick="analytics.updateChart('sales', 'receita')">Receita</button>
                    <button class="btn btn-sm btn-outline-success" onclick="analytics.updateChart('sales', 'lucro')">Lucro</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="salesChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title">Margem por Produto</h3>
            </div>
            <div class="chart-container">
                <canvas id="marginsChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title">Análise ABC</h3>
            </div>
            <div class="chart-container">
                <canvas id="abcChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title">Top Produtos Lucrativos</h3>
            </div>
            <div class="chart-container">
                <canvas id="topProductsChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title">Distribuição por Transportadora</h3>
            </div>
            <div class="chart-container">
                <canvas id="transportChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Tabelas -->
<div class="tables-section">
  <!-- TOP PRODUTOS -->
  <div class="table-card">
    <div class="table-header-row">
      <h3 class="chart-title">Top Produtos por Lucro</h3>
      <div class="table-toolbar">
        <input id="productsSearch" class="table-search" type="text" placeholder="Filtrar produtos..." />
        <button class="btn-neon btn-compact" id="expandProducts" title="Abrir em modal">
          <i class="fas fa-up-right-from-square"></i> Detalhar
        </button>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table" id="productsTableWrap">
        <thead>
          <tr>
            <th data-type="text">Produto</th>
            <th data-type="text">SKU</th>
            <th data-type="number">Quantidade</th</th>
            <th data-type="currency">Receita</th>
            <th data-type="currency">Lucro</th>
            <th data-type="percent">Margem</th>
            <th data-type="text">Status</th>
          </tr>
        </thead>
        <tbody id="productsTable">
          <tr><td colspan="7" class="text-center">Carregando dados...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- TRANSPORTADORAS -->
  <div class="table-card">
    <div class="table-header-row">
      <h3 class="chart-title">Análise por Transportadora</h3>
      <div class="table-toolbar">
        <input id="transportSearch" class="table-search" type="text" placeholder="Filtrar transportadoras..." />
        <button class="btn-neon btn-compact" id="expandTransport" title="Abrir em modal">
          <i class="fas fa-up-right-from-square"></i> Detalhar
        </button>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table" id="transportTableWrap">
        <thead>
          <tr>
            <th data-type="text">Transportadora</th>
            <th data-type="number">Quantidade</th>
            <th data-type="currency">Receita Total</th>
            <th data-type="currency">Lucro Total</th>
            <th data-type="currency">Ticket Médio</th>
            <th data-type="percent">Margem Média</th>
            <th data-type="text">Performance</th>
          </tr>
        </thead>
        <tbody id="transportTable">
          <tr><td colspan="7" class="text-center">Carregando dados...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Script modularizado -->
<script src="{{ url_for('static', filename='js/vendas/shopee/shopee_analytics.js') }}"></script>
{% endblock %}
